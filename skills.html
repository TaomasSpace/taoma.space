<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TAOMAâ„¢ â€” Skills</title>
  <meta name="description" content="Back-end skills by TAOMAâ„¢ â€” live demos and specialties." />
  <link rel="icon" type="image/png" href="/static/icon.png" />
  <style>
    /* reuse your existing base variables + components (copy from other pages) */
    *,
    *::before,
    *::after {
      box-sizing: border-box
    }

    :root {
      --bg: #0e1020;
      --bg-soft: #141735;
      --card: #171b3b;
      --ink: #e9ebff;
      --muted: #a2a9c8;
      --acc: #85a3ff;
      --ring: #85a3ff55;
      --radius: 16px;
      --space: clamp(16px, 2vw, 24px);
      --container: 1100px;
      --shadow: 0 10px 30px rgba(0, 0, 0, .35), 0 2px 8px rgba(0, 0, 0, .25)
    }

    body {
      margin: 0;
      font: 15px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
      color: var(--ink);
      background: var(--bg);
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      position: relative
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background:
        radial-gradient(1400px 900px at 12% -8%, #1b1f45 0%, #1b1f45 35%, transparent 72%),
        radial-gradient(1200px 800px at 100% -10%, #0b4ea8 0%, #0b4ea8 28%, transparent 68%),
        radial-gradient(900px 500px at 95% 115%, #0b4ea84d 0%, transparent 60%),
        linear-gradient(160deg, #0f1531 0%, #0e1020 72%)
    }

    a {
      text-decoration: none;
      color: inherit
    }

    img {
      max-width: 100%;
      display: block
    }

    .container {
      max-width: var(--container);
      margin: 0 auto;
      padding-inline: var(--space)
    }

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: saturate(1.1) blur(10px);
      background: linear-gradient(180deg, #0c0f24cc 0%, #0c0f2400 100%);
      border-bottom: 1px solid #ffffff14
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px
    }

    .brand {
      display: flex;
      align-items: center;
      gap: .75rem;
      font-weight: 800;
      letter-spacing: .4px
    }

    .brand .logo {
      width: 28px;
      height: 28px;
      border-radius: 8px
    }

    .links {
      display: flex;
      gap: 1rem;
      align-items: center
    }

    .links a {
      padding: .45rem .7rem;
      border-radius: 10px;
      border: 1px solid transparent
    }

    .links a:hover {
      border-color: #ffffff1f;
      background: #ffffff0f
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: .6rem;
      padding: .75rem 1rem;
      border-radius: 12px;
      background: var(--acc);
      color: #fff;
      font-weight: 600;
      border: 1px solid #ffffff1a;
      box-shadow: var(--shadow)
    }

    .btn.ghost {
      background: transparent;
      color: var(--ink);
      border: 1px solid #ffffff26;
      box-shadow: none
    }

    .card {
      background: linear-gradient(180deg, color-mix(in oklab, var(--card), transparent 8%), var(--card));
      border: 1px solid #ffffff1a;
      border-radius: var(--radius);
      box-shadow: var(--shadow)
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: .35rem .6rem;
      border-radius: 999px;
      background: color-mix(in oklab, var(--acc) 15%, transparent);
      border: 1px solid #ffffff1a;
      font-size: .85rem
    }

    .muted {
      color: var(--muted)
    }

    .hero {
      padding-block: clamp(48px, 8vw, 120px) clamp(16px, 3vw, 28px);
      text-align: center
    }

    .hero .title {
      font-size: clamp(28px, 6vw, 56px);
      line-height: 1.1;
      margin: 0 0 .6rem
    }

    .hero .subtitle {
      font-size: clamp(16px, 2.6vw, 20px);
      color: var(--muted);
      margin: 0
    }

    .grid {
      display: grid;
      gap: clamp(14px, 2vw, 20px)
    }

    .grid.cols-3 {
      grid-template-columns: repeat(3, 1fr)
    }

    @media (max-width:950px) {
      .grid.cols-3 {
        grid-template-columns: repeat(2, 1fr)
      }
    }

    @media (max-width:640px) {
      .grid.cols-3 {
        grid-template-columns: 1fr
      }
    }

    .card.pad {
      padding: 1.1rem
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem
    }

    .skills {
      display: flex;
      flex-wrap: wrap;
      gap: .5rem
    }

    /* progress */
    .progress {
      height: 10px;
      border-radius: 999px;
      background: #ffffff14;
      overflow: hidden;
      border: 1px solid #ffffff1a
    }

    .progress>span {
      display: block;
      height: 100%;
      width: 0%;
      background: var(--acc);
      transition: width .3s ease
    }

    footer {
      border-top: 1px solid #ffffff14;
      padding-block: 24px;
      margin-top: auto
    }

    .foot {
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap
    }

    .social {
      display: flex;
      gap: .6rem
    }

    .social a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid #ffffff26
    }

    /* --- Header --- */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: saturate(1.1) blur(10px);
      background: linear-gradient(180deg, #0c0f24cc 0%, #0c0f2400 100%);
      border-bottom: 1px solid #ffffff14
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px
    }

    .brand {
      display: flex;
      align-items: center;
      gap: .75rem;
      font-weight: 800;
      letter-spacing: .4px
    }

    .brand .logo {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      display: block;
    }


    .links {
      display: flex;
      gap: 1rem;
      align-items: center
    }

    .links a {
      padding: .45rem .7rem;
      border-radius: 10px;
      border: 1px solid transparent
    }

    .links a:hover {
      border-color: #ffffff1f;
      background: #ffffff0f
    }

    .mobile-toggle {
      display: none
    }

    @media (max-width:800px) {
      .mobile-toggle {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        border-radius: 10px;
        border: 1px solid #ffffff26;
        background: transparent
      }

      .links {
        position: fixed;
        inset: 64px 0 auto 0;
        background: linear-gradient(180deg, #0b0f29, #0b0f2945);
        padding: 1rem;
        display: none;
        flex-direction: column
      }

      .links.open {
        display: flex
      }
    }

    :focus-visible {
      outline: 2px solid var(--acc);
      outline-offset: 2px;
      box-shadow: 0 0 0 6px var(--ring)
    }

    .code {
      white-space: pre;
      background: #0b0f29;
      padding: .75rem;
      border-radius: 12px;
      border: 1px solid #ffffff1a;
      overflow: auto;
    }

    #echoOut p {
      margin: .25rem 0;
    }

    #echoOut code {
      background: #0b0f29;
      padding: .1rem .35rem;
      border-radius: 6px;
      border: 1px solid #ffffff1a;
    }

    .visitor-counter {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font: 600 15px/1.4 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
      color: var(--ink);
      padding: 0.25rem 0.6rem;
      border-radius: 8px;
      background: color-mix(in oklab, var(--card) 35%, transparent);
      border: 1px solid #ffffff1a;
    }

    .visitor-counter svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      color: var(--muted);
    }

    .auth {
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .auth .btn.small {
      padding: .5rem .7rem;
      border-radius: 10px;
      background: transparent;
      color: var(--ink);
      border: 1px solid #ffffff26;
      box-shadow: none;
      font-weight: 600;
    }

    .avatar-btn {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .35rem .55rem;
      border-radius: 999px;
      background: #ffffff10;
      border: 1px solid #ffffff26;
      cursor: pointer;
    }

    .avatar {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
      background: #0f1331;
    }

    .avatar-fallback {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font: 700 12px/1 Inter, ui-sans-serif;
      background: #25306a;
      color: #e9ebff;
    }

    .menu {
      position: absolute;
      margin-top: .4rem;
      right: 0;
      min-width: 160px;
      z-index: 60;
      background: linear-gradient(180deg, color-mix(in oklab, var(--card), transparent 8%), var(--card));
      border: 1px solid #ffffff22;
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: .35rem;
      display: none;
    }

    .menu.open {
      display: block;
    }

    .menu a,
    .menu button {
      width: 100%;
      text-align: left;
      display: block;
      background: transparent;
      color: var(--ink);
      padding: .55rem .65rem;
      border: 0;
      border-radius: 10px;
      cursor: pointer;
    }

    .menu a:hover,
    .menu button:hover {
      background: #ffffff12;
    }
  </style>
</head>

<body>
  <div data-fragment="header"></div>
  <main class="container">
    <section class="hero">
      <h1 class="title">What Iâ€™m good at</h1>
      <p class="subtitle">Back-end first. Fast APIs, clean schemas, simple ops. Try the live demos below ðŸ‘‡</p>
    </section>

    <!-- Skill chips -->
    <section>
      <h2 class="section-title">Specialties</h2>
      <div class="card pad">
        <div class="skills" aria-label="Skills">
          <span class="chip">FastAPI</span>
          <span class="chip">REST design</span>
          <span class="chip">Async / Background jobs</span>
          <span class="chip">Pydantic validation</span>
          <span class="chip">Postgres / SQLite</span>
          <span class="chip">Auth basics (tokens)</span>
          <span class="chip">CI/CD (Render/Oracle)</span>
          <span class="chip">Monitoring basics</span>
          <span class="chip">Discord Bots</span>
        </div>
      </div>
    </section>

    <!-- Interactive demos -->
    <section>
      <h2 class="section-title">Interactive Back-end Demos</h2>
      <div class="grid cols-3">

        <!-- Ping -->
        <article class="card pad">
          <h3>API Ping / Latency</h3>
          <p class="muted">Round-trip time and server UTC timestamp.</p>
          <div class="row">
            <button id="btnPing" class="btn">Run ping</button>
            <span id="pingOut" class="muted"></span>
          </div>
          <div class="progress" style="margin-top:.75rem"><span id="pingBar"></span></div>
        </article>

        <!-- Echo -->
        <article class="card pad">
          <h3>Input Validation (Echo)</h3>
          <p class="muted">Pydantic validates your input; server returns sanitized JSON.</p>
          <textarea id="echoIn" rows="6"
            style="width:100%;border-radius:12px;border:1px solid #ffffff26;background:var(--bg-soft);color:var(--ink);padding:.75rem"
            placeholder='{"message":"Hello","meta":{"source":"skills-page"}}'></textarea>
          <div class="row" style="margin-top:.6rem">
            <button id="btnEcho" class="btn">POST /api/echo</button>
            <div id="echoOut" class="muted"></div>
          </div>
        </article>

        <!-- Job -->
        <article class="card pad">
          <h3>Background Job</h3>
          <p class="muted">Create a job, then watch progress from the server.</p>
          <div class="row">
            <input id="jobSeconds" type="number" min="1" max="20" value="5"
              style="width:90px;border-radius:12px;border:1px solid #ffffff26;background:var(--bg-soft);color:var(--ink);padding:.5rem .7rem" />
            <button id="btnJob" class="btn">Create job</button>
            <span id="jobOut" class="muted"></span>
          </div>
          <div class="progress" style="margin-top:.75rem"><span id="jobBar"></span></div>
        </article>

      </div>
    </section>

    <section style="margin-top:1rem">
      <div class="card pad">
        <p style="margin:0" class="muted">
          Like what you see? I build fast, maintainable APIs and back-end tools.
        </p>
        <div class="row" style="margin-top:.6rem">
          <a class="btn" href="/contact">Letâ€™s work together</a>
          <a class="btn ghost" href="/projects">See projects</a>
        </div>
      </div>
    </section>
    <br>
  </main>

  <div data-fragment="footer"></div>

  <script src="/static/layout.js"></script>

  <script>
    // mobile menu
    const toggle = document.getElementById('mobileToggle');
    const menu = document.getElementById('primary-menu');
    toggle?.addEventListener('click', () => {
      const open = menu.classList.toggle('open');
      toggle.setAttribute('aria-expanded', String(open));
    });
    // year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Ping demo
    const btnPing = document.getElementById('btnPing');
    const pingOut = document.getElementById('pingOut');
    const pingBar = document.getElementById('pingBar');
    btnPing?.addEventListener('click', async () => {
      pingOut.textContent = "Runningâ€¦";
      pingBar.style.width = "0%";
      const t0 = performance.now();
      try {
        const r = await fetch('/api/ping', { cache: 'no-store' });
        const data = await r.json();
        const ms = Math.round(performance.now() - t0);
        pingOut.textContent = `~${ms}ms â€¢ server: ${new Date(data.server_time).toUTCString()}`;
        pingBar.style.width = Math.min(100, Math.max(5, ms)) + "%";
      } catch (e) {
        pingOut.textContent = "Failed.";
      }
    });

    // Echo demo
    const btnEcho = document.getElementById('btnEcho');
    const echoIn = document.getElementById('echoIn');
    const echoOut = document.getElementById('echoOut');

    btnEcho?.addEventListener('click', async () => {
      echoOut.textContent = "Sendingâ€¦";
      let body;
      try {
        body = JSON.parse(echoIn.value);
      } catch {
        echoOut.textContent = "Invalid JSON.";
        return;
      }

      try {
        const r = await fetch('/api/echo', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        const res = await r.json();

        if (r.ok && res?.data) {
          echoOut.innerHTML = res.data;
        } else {
          echoOut.textContent = "Validation failed.";
        }
      } catch {
        echoOut.textContent = "Request failed.";
      }
    });

    // Job demo
    const btnJob = document.getElementById('btnJob');
    const jobSec = document.getElementById('jobSeconds');
    const jobOut = document.getElementById('jobOut');
    const jobBar = document.getElementById('jobBar');
    btnJob?.addEventListener('click', async () => {
      jobOut.textContent = "Queueingâ€¦";
      jobBar.style.width = "0%";
      try {
        const r = await fetch('/api/job', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ seconds: Number(jobSec.value) || 3 })
        });
        const { job_id } = await r.json();
        if (!job_id) { jobOut.textContent = "Failed to create job."; return; }
        jobOut.textContent = `Job ${job_id.slice(0, 8)}â€¦ running`;
        const t = setInterval(async () => {
          const st = await fetch(`/api/job/${job_id}`, { cache: 'no-store' }).then(x => x.json());
          if (!st.ok) { jobOut.textContent = "Job not found."; clearInterval(t); return; }
          jobBar.style.width = (st.progress || 0) + "%";
          if (st.status === "done") { jobOut.textContent = "Done âœ”"; clearInterval(t); }
        }, 700);
      } catch {
        jobOut.textContent = "Failed.";
      }
    });

    //visitor counter
    (async () => {
      const KEY = "taoma_last_counted_at";
      const DAY = 24 * 60 * 60 * 1000;
      const now = Date.now();
      const last = parseInt(localStorage.getItem(KEY) || "0", 10);
      const shouldCount = !last || (now - last) > DAY;

      if (shouldCount) {
        navigator.sendBeacon("/api/visits/increment");
        localStorage.setItem(KEY, String(now));
      }

      const res = await fetch("/api/visits/value");
      const { total } = await res.json();
      document.getElementById("visitor-count").textContent = total ?? "0";
    })();
    // === Auth header renderer ===
    async function renderAuthHeader() {
      const slot = document.getElementById('authSlot');
      if (!slot) return;

      const token = localStorage.getItem('gifapi_token');
      let user = null;
      let isAdmin = false;

      if (token) {
        try {
          const r = await fetch('/api/auth/verify', { headers: { 'X-Auth-Token': token } });
          if (r.ok) {
            const data = await r.json();
            user = data?.user || null;
            isAdmin = !!(user && user.admin);
          } else {
            // Token ungÃ¼ltig â†’ wegrÃ¤umen
            localStorage.removeItem('gifapi_token');
            localStorage.removeItem('gifapi_token_expires');
          }
        } catch { }
      }

      if (!user) {
        // --- not logged in ---
        slot.innerHTML = `
        <a class="btn small" href="/login">Login</a>
        <a class="btn small" href="/register">Register</a>
      `;
        return;
      }

      // --- logged in ---
      const uname = user.username || 'User';
      const initials = uname.trim().slice(0, 2).toUpperCase();
      const pfp = user.profile_picture && String(user.profile_picture).trim();

      slot.innerHTML = `
      <div class="auth-box" style="position:relative">
        <button class="avatar-btn" id="avatarBtn" aria-haspopup="menu" aria-expanded="false">
          ${pfp ? `<img class="avatar" src="${pfp}" alt="${uname}'s profile picture">`
          : `<span class="avatar-fallback" aria-hidden="true">${initials}</span>`}
          <span class="uname" style="font-weight:700;font-size:.95rem">${uname}</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="menu" id="userMenu" role="menu" aria-label="User menu">
          <a href="/profile" role="menuitem">Profile</a>
          ${isAdmin ? `<a href="/admin" role="menuitem">Admin</a>` : ``}
          <button id="logoutBtn" role="menuitem">Logout</button>
        </div>
      </div>
    `;

      const btn = slot.querySelector('#avatarBtn');
      const menu = slot.querySelector('#userMenu');
      const logoutBtn = slot.querySelector('#logoutBtn');

      function closeMenu() {
        menu.classList.remove('open');
        btn.setAttribute('aria-expanded', 'false');
      }

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const open = menu.classList.toggle('open');
        btn.setAttribute('aria-expanded', String(open));
      });

      document.addEventListener('click', (e) => {
        if (!menu.contains(e.target) && !btn.contains(e.target)) closeMenu();
      });

      logoutBtn.addEventListener('click', async () => {
        try {
          const t = localStorage.getItem('gifapi_token');
          if (t) {
            await fetch('/api/auth/logout', { method: 'POST', headers: { 'X-Auth-Token': t } }).catch(() => { });
          }
        } catch { }
        localStorage.removeItem('gifapi_token');
        localStorage.removeItem('gifapi_token_expires');
        window.location.href = '/';
      }, { passive: true });
    }

    // Render bei Load
    renderAuthHeader();
  </script>
</body>

</html>