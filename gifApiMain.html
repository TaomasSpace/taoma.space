<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Anime GIF API ‚Äì Explorer & Docs</title>
    <style>
        :root {
            --bg: #0f1223;
            --card: #161a34;
            --ink: #e7e9ff;
            --muted: #9aa3c7;
            --acc: #7c9cff;
            --ok: #2ecc71;
            --err: #e74c3c
        }

        * {
            box-sizing: border-box;
            font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif
        }

        body {
            margin: 0;
            background: linear-gradient(120deg, #0f1223 0%, #13183a 70%)
        }

        .wrap {
            max-width: 1100px;
            margin: 28px auto;
            padding: 0 16px
        }

        h1 {
            color: var(--ink);
            margin: 0 0 8px;
            font-weight: 800
        }

        h2,
        h3 {
            color: var(--ink);
            margin: 0 0 8px
        }

        p,
        .muted {
            color: var(--muted)
        }

        .card {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .25);
            padding: 18px;
            margin: 16px 0
        }

        .row {
            display: grid;
            gap: 12px
        }

        @media(min-width:780px) {
            .cols-2 {
                grid-template-columns: 1fr 1fr
            }

            .cols-3 {
                grid-template-columns: 1fr 1fr 1fr
            }
        }

        label {
            color: var(--ink);
            font-size: 14px;
            font-weight: 700;
            margin: 8px 0 4px;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .hint {
            font-size: 12px;
            color: var(--muted)
        }

        input,
        select {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 12px;
            background: #0e1330;
            color: var(--ink);
            outline: none
        }

        input:focus,
        select:focus {
            border-color: var(--acc)
        }

        .btn {
            cursor: pointer;
            background: var(--acc);
            color: #080b1d;
            border: none;
            border-radius: 12px;
            padding: 10px 14px;
            font-weight: 800
        }

        .btn.secondary {
            background: #25305e;
            color: #cfe0ff
        }

        .btn.ghost {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, .2);
            color: #cfe0ff
        }

        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap
        }

        code,
        pre {
            background: #0b1030;
            color: #cfe0ff;
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 10px
        }

        .mono {
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, Monaco, "Liberation Mono", "Courier New", monospace
        }

        pre {
            padding: 12px;
            white-space: pre-wrap
        }

        .status {
            margin-top: 8px
        }

        .ok {
            color: var(--ok)
        }

        .err {
            color: var(--err)
        }

        .pill {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            background: #0b1030;
            border: 1px solid rgba(255, 255, 255, .08);
            color: #c7cffd;
            font-size: 12px
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px
        }

        .gifCard {
            background: #0e1330;
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 12px;
            padding: 10px
        }

        .gifCard img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, .08)
        }

        .tabs {
            display: flex;
            gap: 6px;
            margin: 8px 0
        }

        .tab {
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, .15);
            cursor: pointer
        }

        .tab.active {
            background: var(--acc);
            color: #080b1d;
            border-color: transparent
        }

        details>summary {
            cursor: pointer;
            color: #cfe0ff
        }

        table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 12px;
            overflow: hidden
        }

        th,
        td {
            padding: 8px 10px;
            border-bottom: 1px solid rgba(255, 255, 255, .06);
            color: #cfe0ff;
            font-size: 14px
        }

        th {
            background: #0e1330;
            text-align: left
        }

        .kbd {
            font-family: ui-monospace;
            background: #11163a;
            border: 1px solid rgba(255, 255, 255, .08);
            padding: 1px 6px;
            border-radius: 6px
        }
    </style>
</head>

<body>
    <div class="wrap">
        <h1 data-i18n="title.main">Anime GIF API ‚Äì Explorer &amp; Docs</h1>

        <p data-i18n="intro.main">
            Baue Anfragen an <code>/gifs</code>, sieh sofort die URL, den Code (Python &amp; cURL) und die Antwort.
            Lerne
            unten die Regeln &amp; Beispiele. Wenn alles leer ist, verwenden wir <code>/gifs?</code> ‚Üí ein zuf√§lliges
            GIF.
        </p>

        <div id="langPicker"
            style="position:fixed;top:12px;right:12px;z-index:20;display:flex;gap:8px;align-items:center">
            <label for="lang" title="Language">üåê</label>
            <select id="lang"
                style="background:#0e1330;border:1px solid rgba(255,255,255,.2);color:#e7e9ff;border-radius:8px;padding:6px 8px">
                <option value="de">Deutsch</option>
                <option value="en">English</option>
            </select>
        </div>

        <!-- BUILDER -->
        <div class="card">
            <h2 data-i18n="section.builder">Query Builder</h2>

            <div class="row cols-3">
                <div>
                    <label for="base" data-i18n="label.base">API-Basis-URL</label>
                    <input id="base" type="url" value="https://taoma.space" data-i18n-placeholder="ph.base"
                        placeholder="https://deine-api.tld" required>
                    <div class="hint" data-i18n="hint.base">Deine deployte Instanz. Kein Slash am Ende n√∂tig.</div>
                </div>
                <div>
                    <label for="nsfw" data-i18n="label.nsfw">NSFW-Modus</label>&nbsp;<span
                        class="pill">false|true|only</span>
                    <select id="nsfw">
                        <option value="false" selected>false</option>
                        <option value="true">true</option>
                        <option value="only">only</option>
                    </select>
                    <div class="hint" data-i18n="hint.nsfw">Standard ist <code>false</code>.</div>
                </div>
                <div>
                    <label for="list" data-i18n="label.list">Liste (list)</label>
                    <select id="list">
                        <option value="">‚Äî</option>
                        <option value="tags">tags</option>
                    </select>
                    <div class="hint" data-i18n="hint.list">Mit <code>list=tags</code> bekommst du alle verf√ºgbaren
                        Tags.</div>
                </div>
            </div>

            <div class="row cols-3">
                <div>
                    <label for="q" data-i18n="label.q">Suche im Titel (q)</label>
                    <input id="q" type="text" data-i18n-placeholder="ph.q" placeholder="z. B. Nazuna">
                    <div class="hint" data-i18n="hint.q">Wenn gesetzt, dann kein tag/anime/character benutzen.</div>
                </div>
                <div>
                    <label for="tag" data-i18n="label.tag">Tag (tag)</label>
                    <div class="actions">
                        <select id="tag">
                            <option value="">‚Äî</option>
                        </select>
                        <button id="refreshTags" class="btn secondary" type="button" data-i18n="btn.refreshTags">Tags
                            neu laden</button>
                    </div>
                    <div class="hint" data-i18n="hint.tags">Dropdown l√§dt mit <code>GET /gifs?list=tags</code>.</div>
                </div>
                <div>
                    <label for="anime" data-i18n="label.anime">Anime (anime)</label>
                    <input id="anime" type="text" data-i18n-placeholder="ph.anime" placeholder="Call of the Night">
                    <div class="hint" data-i18n="hint.anime">Exakter Match (case-insensitive).</div>
                </div>
            </div>

            <div class="row cols-3">
                <div>
                    <label for="character" data-i18n="label.character">Character (character)</label>
                    <input id="character" type="text" data-i18n-placeholder="ph.character" placeholder="Nazuna">
                    <div class="hint" data-i18n="hint.character">Exakter Match (case-insensitive).</div>
                </div>
                <div>
                    <label for="limit" data-i18n="label.limit">Limit (limit)</label>
                    <input id="limit" type="number" min="1" max="200" data-i18n-placeholder="ph.limit"
                        placeholder="z. B. 50">
                    <div class="hint" data-i18n="hint.limit">Wie viele Ergebnisse maximal zur√ºckgegeben werden.</div>
                </div>
                <div>
                    <label for="offset" data-i18n="label.offset">Offset (offset)</label>
                    <input id="offset" type="number" min="0" data-i18n-placeholder="ph.offset" placeholder="z. B. 0">
                    <div class="hint" data-i18n="hint.offset">Startposition (Pagination).</div>
                </div>
            </div>

            <div class="actions" style="margin-top:8px">
                <button id="presetRandom" class="btn" data-i18n="btn.presetRandom">Preset: Random</button>
                <button id="presetSfw" class="btn secondary" data-i18n="btn.presetSfw">Preset: Random SFW</button>
                <button id="presetTag" class="btn secondary" data-i18n="btn.presetTag">Preset: Tag</button>
                <button id="presetAnime" class="btn secondary" data-i18n="btn.presetAnime">Preset: Anime</button>
                <button id="presetChar" class="btn secondary" data-i18n="btn.presetChar">Preset: Character</button>
                <button id="clearAll" class="btn ghost" data-i18n="btn.reset">Zur√ºcksetzen</button>
            </div>

            <div style="margin-top:14px">
                <label data-i18n="label.finalUrl">Fertige URL</label>
                <div class="actions">
                    <code id="outUrl" class="mono">/gifs?</code>
                    <button id="copyUrl" class="btn secondary" data-i18n="btn.copy">Kopieren</button>
                    <button id="shareUrl" class="btn secondary" data-i18n="btn.share">Share-Link</button>
                    <button id="run" class="btn" data-i18n="btn.run">Ausf√ºhren</button>
                </div>
                <div id="ruleMsg" class="status"></div>
            </div>

            <div style="margin-top:12px">
                <div class="tabs">
                    <div id="tabPy" class="tab active" data-i18n="tab.py">Python (requests)</div>
                    <div id="tabCurl" class="tab" data-i18n="tab.curl">cURL</div>
                </div>
                <pre id="codeBox" class="mono"></pre>
                <div class="actions"><button id="copyCode" class="btn secondary" data-i18n="btn.copyCode">Code
                        kopieren</button></div>
            </div>
        </div>

        <!-- RESULT -->
        <div class="card">
            <h2 data-i18n="section.response">Antwort</h2>
            <div id="resultSummary" class="muted">‚Äî</div>

            <div id="singleView" style="display:none" class="row cols-2">
                <div><img id="gifImg" alt="GIF Preview"
                        style="max-width:100%;border-radius:12px;border:1px solid rgba(255,255,255,.08)"></div>
                <div>
                    <div id="gifMeta" class="muted"></div>
                    <div class="actions" style="margin-top:8px">
                        <a id="openGif" class="btn secondary" href="#" target="_blank" rel="noopener"
                            data-i18n="btn.openGif">GIF √∂ffnen</a>
                        <button id="copyGifUrl" class="btn secondary" type="button" data-i18n="btn.copyGifUrl">GIF-URL
                            kopieren</button>
                    </div>
                </div>
            </div>

            <div id="listView" class="grid" style="display:none"></div>

            <div class="actions" style="margin-top:10px">
                <button id="prevPage" class="btn secondary" data-i18n="btn.prev">¬´ Zur√ºck</button>
                <button id="nextPage" class="btn secondary" data-i18n="btn.next">Weiter ¬ª</button>
            </div>

            <pre id="rawBox" class="mono muted" style="margin-top:12px">‚Äî</pre>
        </div>

        <!-- HISTORY -->
        <div class="card">
            <h2 data-i18n="section.history">History (local)</h2>
            <p class="muted" data-i18n="history.info">Zuletzt ausgef√ºhrte Anfragen. Klicke, um sie erneut zu laden.</p>
            <div id="history" class="grid"></div>
            <div class="actions" style="margin-top:8px">
                <button id="clearHistory" class="btn ghost" data-i18n="btn.clearHistory">History l√∂schen</button>
            </div>
        </div>

        <!-- DOCS -->
        <div class="card">
            <h2 data-i18n="section.docs">API-Dokumentation</h2>

            <details open>
                <summary data-i18n="docs.rules.title"><b>Regeln &amp; Verhalten</b></summary>
                <ul>
                    <li data-i18n="docs.rule1">
                        <span class="kbd">q</span> (Titelsuche) ist exklusiv: <b>Entweder</b> <span class="kbd">q</span>
                        <b>oder</b> genau eins von <span class="kbd">tag</span>/<span class="kbd">anime</span>/<span
                            class="kbd">character</span>.
                    </li>
                    <li data-i18n="docs.rule2"><span class="kbd">nsfw</span> ‚àà {<code>false</code>, <code>true</code>,
                        <code>only</code>} ‚Äì Standard <code>false</code>.</li>
                    <li data-i18n="docs.rule3">Ohne Filter liefert <code>/gifs?</code> ein zuf√§lliges GIF (mit
                        NSFW-Filter laut <code>nsfw</code>).</li>
                    <li data-i18n="docs.rule4"><span class="kbd">limit</span> &amp; <span class="kbd">offset</span>
                        dienen der Pagination (nur bei Titelsuche sinnvoll).</li>
                    <li data-i18n="docs.rule5"><code>list=tags</code> gibt alle Tags zur√ºck (ignoriert andere Filter).
                    </li>
                </ul>
            </details>

            <div style="overflow:auto;margin-top:10px">
                <table>
                    <thead>
                        <tr>
                            <th data-i18n="tbl.param">Parameter</th>
                            <th data-i18n="tbl.type">Typ</th>
                            <th data-i18n="tbl.example">Beispiel</th>
                            <th data-i18n="tbl.desc">Beschreibung</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>q</code></td>
                            <td>string</td>
                            <td><code>q=Nazuna</code></td>
                            <td data-i18n="docs.row.q">Suche im <b>Titel</b>. Nicht zusammen mit tag/anime/character.
                            </td>
                        </tr>
                        <tr>
                            <td><code>tag</code></td>
                            <td>string</td>
                            <td><code>tag=smoking</code></td>
                            <td data-i18n="docs.row.tag">Random GIF mit diesem Tag.</td>
                        </tr>
                        <tr>
                            <td><code>anime</code></td>
                            <td>string</td>
                            <td><code>anime=Call of the Night</code></td>
                            <td data-i18n="docs.row.anime">Random GIF aus diesem Anime.</td>
                        </tr>
                        <tr>
                            <td><code>character</code></td>
                            <td>string</td>
                            <td><code>character=Nazuna</code></td>
                            <td data-i18n="docs.row.character">Random GIF mit diesem Character.</td>
                        </tr>
                        <tr>
                            <td><code>list</code></td>
                            <td>string</td>
                            <td><code>list=tags</code></td>
                            <td data-i18n="docs.row.list">Liste aller Tags.</td>
                        </tr>
                        <tr>
                            <td><code>nsfw</code></td>
                            <td>enum</td>
                            <td><code>nsfw=false</code></td>
                            <td data-i18n="docs.row.nsfw"><code>false</code>=nur SFW, <code>true</code>=beides,
                                <code>only</code>=nur NSFW.</td>
                        </tr>
                        <tr>
                            <td><code>limit</code></td>
                            <td>int</td>
                            <td><code>limit=20</code></td>
                            <td data-i18n="docs.row.limit">Max. Ergebnisse (1‚Äì200). F√ºr Titelsuche.</td>
                        </tr>
                        <tr>
                            <td><code>offset</code></td>
                            <td>int</td>
                            <td><code>offset=20</code></td>
                            <td data-i18n="docs.row.offset">Startposition (Pagination). F√ºr Titelsuche.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <p class="muted" style="margin-top:8px" data-i18n="docs.note">
                Hinweis: Bei Tippfehlern in <code>anime</code>/<code>character</code> liefert die API sinnvolle
                Vorschl√§ge im
                Fehlerobjekt (HTTP 404, Feld <code>suggestions</code>).
            </p>
        </div>
    </div>

    <script>
        const $ = s => document.querySelector(s);
        const el = id => document.getElementById(id);

        // Inputs
        const base = el('base'), nsfw = el('nsfw'), listSel = el('list');
        const q = el('q'), tag = el('tag'), anime = el('anime'), character = el('character');
        const limit = el('limit'), offset = el('offset');

        // UI outputs
        const outUrl = el('outUrl'), ruleMsg = el('ruleMsg');
        const codeBox = el('codeBox'); let activeTab = 'py';
        const resultSummary = el('resultSummary'), rawBox = el('rawBox');
        const singleView = el('singleView'), gifImg = el('gifImg'), gifMeta = el('gifMeta'), openGif = el('openGif');
        const listView = el('listView');
        const prevPage = el('prevPage'), nextPage = el('nextPage');
        const historyWrap = el('history');

        // State
        const PAGE_DEFAULT = 20;

        // Helpers
        function cleanBase(u) { return (u || '').replace(/\/+$/, '') }
        function paramsValidXor(p) {
            const hasQ = !!p.q;
            const singles = ['tag', 'anime', 'character'].filter(k => !!p[k]);
            if (hasQ && singles.length > 0) return { ok: false, msg: "Entweder 'q' ODER eins von 'tag/anime/character' setzen ‚Äì nicht beides." };
            if (!hasQ && singles.length > 1) return { ok: false, msg: "Bitte nur EINES von 'tag/anime/character' setzen." };
            return { ok: true, msg: '' };
        }
        function buildParams() {
            const p = {};
            if (q.value.trim()) p.q = q.value.trim();
            if (!p.q) {
                if (tag.value) p.tag = tag.value;
                else if (anime.value.trim()) p.anime = anime.value.trim();
                else if (character.value.trim()) p.character = character.value.trim();
            }
            if (listSel.value) p.list = listSel.value;
            p.nsfw = nsfw.value || 'false';
            if (limit.value) p.limit = Number(limit.value);
            if (offset.value) p.offset = Number(offset.value);
            return p;
        }
        function paramsToQS(p) {
            const sp = new URLSearchParams();
            Object.entries(p).forEach(([k, v]) => { if (v !== undefined && v !== null && v !== '') sp.set(k, String(v)) });
            const s = sp.toString();
            return s ? '/api/gifs?' + s : '/api/gifs?';
        }
        function renderUrlAndCode() {
            const p = buildParams();
            const v = paramsValidXor(p);
            ruleMsg.textContent = v.ok ? '' : v.msg;
            ruleMsg.className = 'status ' + (v.ok ? '' : 'err');

            const path = paramsToQS(p);
            const full = cleanBase(base.value) + path;
            outUrl.textContent = full;

            const py = `import requests

BASE = "${cleanBase(base.value)}"
params = ${JSON.stringify(p, null, 2) || "{}"}
r = requests.get(f"{BASE}/api/gifs", params=(params or None), timeout=10)
r.raise_for_status()
print(r.json())`;

            const curl = `curl -sS "${cleanBase(base.value)}/api/gifs${Object.keys(p).length ? ('?' + new URLSearchParams(p).toString()) : ''}"`;

            codeBox.textContent = (activeTab === 'py') ? py : curl;
        }
        function syncLocks() {
            const hasQ = q.value.trim() !== '';
            [tag, anime, character].forEach(elm => elm.disabled = hasQ);
            const singles = [tag.value, anime.value.trim(), character.value.trim()].filter(Boolean).length;
            q.disabled = singles > 0;
        }

        // Events
        [base, nsfw, listSel, q, tag, anime, character, limit, offset].forEach(x => {
            x.addEventListener('input', () => { syncLocks(); renderUrlAndCode(); });
            x.addEventListener('change', () => { syncLocks(); renderUrlAndCode(); });
        });

        el('tabPy').onclick = () => { activeTab = 'py'; el('tabPy').classList.add('active'); el('tabCurl').classList.remove('active'); renderUrlAndCode(); };
        el('tabCurl').onclick = () => { activeTab = 'curl'; el('tabCurl').classList.add('active'); el('tabPy').classList.remove('active'); renderUrlAndCode(); };

        el('copyUrl').onclick = async () => { try { await navigator.clipboard.writeText(outUrl.textContent); } catch { } };
        el('shareUrl').onclick = async () => { try { await navigator.clipboard.writeText(outUrl.textContent); } catch { } };
        el('copyCode').onclick = async () => { try { await navigator.clipboard.writeText(codeBox.textContent); } catch { } };
        el('copyGifUrl')?.addEventListener('click', async () => { try { await navigator.clipboard.writeText(openGif.href); } catch { } });

        function resetFilters() { q.value = ''; tag.value = ''; anime.value = ''; character.value = ''; limit.value = ''; offset.value = ''; listSel.value = ''; nsfw.value = 'false'; }
        el('presetRandom').onclick = (e) => { e.preventDefault(); resetFilters(); nsfw.value = 'true'; renderUrlAndCode(); };
        el('presetSfw').onclick = (e) => { e.preventDefault(); resetFilters(); nsfw.value = 'false'; renderUrlAndCode(); };
        el('presetTag').onclick = (e) => { e.preventDefault(); resetFilters(); tag.value = tag.options.length > 1 ? tag.options[1].value : ''; nsfw.value = 'true'; renderUrlAndCode(); };
        el('presetAnime').onclick = (e) => { e.preventDefault(); resetFilters(); anime.value = 'Call of the Night'; nsfw.value = 'false'; renderUrlAndCode(); };
        el('presetChar').onclick = (e) => { e.preventDefault(); resetFilters(); character.value = 'Nazuna'; nsfw.value = 'false'; renderUrlAndCode(); };
        el('clearAll').onclick = (e) => { e.preventDefault(); resetFilters(); renderUrlAndCode(); };

        async function loadTags() {
            try {
                const url = cleanBase(base.value) + '/api/gifs?list=tags';
                const r = await fetch(url);
                if (!r.ok) throw new Error(await r.text());
                const tagsList = await r.json();
                const cur = tag.value;
                tag.innerHTML = '<option value="">‚Äî</option>' + (tagsList || []).map(t => `<option>${t}</option>`).join('');
                if ([...tag.options].some(o => o.value === cur)) tag.value = cur;
            } catch (e) { console.warn('Tags konnten nicht geladen werden', e); }
        }
        el('refreshTags').onclick = loadTags;
        window.addEventListener('load', loadTags);

        function pushHistory(fullUrl) {
            try {
                const h = JSON.parse(localStorage.getItem('gifapi_history') || '[]');
                h.unshift({ url: fullUrl, ts: Date.now() });
                const uniq = []; const seen = new Set();
                for (const item of h) {
                    if (!seen.has(item.url)) { uniq.push(item); seen.add(item.url); }
                    if (uniq.length >= 30) break;
                }
                localStorage.setItem('gifapi_history', JSON.stringify(uniq));
            } catch { }
        }
        function renderHistory() {
            try {
                const h = JSON.parse(localStorage.getItem('gifapi_history') || '[]');
                historyWrap.innerHTML = h.map(it => `
          <div class="gifCard">
            <div class="muted" style="font-size:12px">${new Date(it.ts).toLocaleString()}</div>
            <div style="word-break:break-all;color:#e7e9ff;font-size:13px;margin:6px 0">${it.url}</div>
            <div class="actions">
              <button class="btn secondary" data-open="${it.url}">√ñffnen</button>
              <button class="btn ghost" data-apply="${it.url}">In Builder laden</button>
            </div>
          </div>`).join('');
                historyWrap.querySelectorAll('[data-open]').forEach(b => b.onclick = () => window.open(b.dataset.open, '_blank'));
                historyWrap.querySelectorAll('[data-apply]').forEach(b => b.onclick = () => {
                    const u = new URL(b.dataset.apply);
                    base.value = u.origin;
                    const sp = u.searchParams;
                    q.value = sp.get('q') || '';
                    tag.value = sp.get('tag') || '';
                    anime.value = sp.get('anime') || '';
                    character.value = sp.get('character') || '';
                    nsfw.value = sp.get('nsfw') || 'false';
                    listSel.value = sp.get('list') || '';
                    limit.value = sp.get('limit') || '';
                    offset.value = sp.get('offset') || '';
                    syncLocks(); renderUrlAndCode();
                });
            } catch { historyWrap.innerHTML = ''; }
        }
        el('clearHistory').onclick = () => { localStorage.removeItem('gifapi_history'); renderHistory(); };

        async function runQuery() {
            const p = buildParams();
            const v = paramsValidXor(p);
            if (!v.ok) { ruleMsg.textContent = v.msg; ruleMsg.className = 'status err'; return; }

            const baseUrl = cleanBase(base.value);
            const qs = new URLSearchParams(p);
            const url = baseUrl + '/api/gifs' + (qs.toString() ? ('?' + qs.toString()) : '');
            outUrl.textContent = url;

            try {
                const r = await fetch(url);
                const text = await r.text();
                let data = null;
                try { data = JSON.parse(text); } catch { data = { raw: text }; }
                rawBox.textContent = JSON.stringify(data, null, 2);

                singleView.style.display = 'none'; listView.style.display = 'none';
                if (Array.isArray(data)) {
                    resultSummary.textContent = `${data.length} Ergebnis(se).`;
                    listView.innerHTML = data.map(g => `
            <div class="gifCard">
              <img src="${g.url || ''}" alt="">
              <div style="color:#e7e9ff;font-weight:700;margin-top:6px">${g.title || '‚Äî'}</div>
              <div class="muted" style="font-size:12px">#${g.id || '?'} ‚Ä¢ ${(g.anime || '‚Äî')} ‚Ä¢ ${(g.nsfw ? 'nsfw' : 'sfw')}</div>
              <div class="actions" style="margin-top:6px">
                <a class="btn secondary" href="${g.url || '#'}" target="_blank" rel="noopener">Open</a>
                <button class="btn ghost" data-copy="${g.url || ''}">Copy URL</button>
              </div>
            </div>`).join('');
                    listView.querySelectorAll('[data-copy]').forEach(b => b.onclick = async () => { try { await navigator.clipboard.writeText(b.dataset.copy); } catch { } });
                    listView.style.display = '';
                } else if (data && data.url) {
                    resultSummary.textContent = `1 Ergebnis.`;
                    gifImg.src = data.url; openGif.href = data.url;
                    gifMeta.innerHTML = `
            <div><b>Title:</b> ${data.title || '‚Äî'}</div>
            <div><b>ID:</b> ${data.id || '‚Äî'}</div>
            <div><b>Anime:</b> ${data.anime || '‚Äî'} &nbsp; <span class="pill">${data.nsfw ? 'nsfw' : 'sfw'}</span></div>
            <div><b>Tags:</b> ${(data.tags || []).join(', ') || '‚Äî'}</div>
            <div><b>Characters:</b> ${(data.characters || []).join(', ') || '‚Äî'}</div>
            <div class="muted">created_at: ${data.created_at || '‚Äî'}</div>`;
                    singleView.style.display = '';
                } else if (p.list === 'tags' && Array.isArray(data)) {
                    resultSummary.textContent = `${data.length} Tags.`;
                } else {
                    resultSummary.textContent = 'Antwort erhalten.';
                }

                pushHistory(url); renderHistory();
            } catch (err) {
                resultSummary.textContent = 'Fehler: ' + err.message;
            }
        }
        el('run').onclick = (e) => { e.preventDefault(); runQuery(); };

        prevPage.onclick = (e) => {
            e.preventDefault();
            const l = Number(limit.value || PAGE_DEFAULT);
            const o = Math.max(0, Number(offset.value || 0) - l);
            offset.value = String(o);
            renderUrlAndCode(); runQuery();
        };
        nextPage.onclick = (e) => {
            e.preventDefault();
            const l = Number(limit.value || PAGE_DEFAULT);
            const o = Number(offset.value || 0) + l;
            offset.value = String(o);
            renderUrlAndCode(); runQuery();
        };

        window.addEventListener('load', () => {
            syncLocks();
            if (!limit.value) limit.value = String(PAGE_DEFAULT);
            renderUrlAndCode();
            renderHistory();
        });

        /* ---------------- I18N ---------------- */
        const I18N = {
            de: {
                "title.main": "Anime GIF API ‚Äì Explorer & Docs",
                "intro.main": "Baue Anfragen an <code>/gifs</code>, sieh sofort die URL, den Code (Python &amp; cURL) und die Antwort. Wenn alles leer ist, verwenden wir <code>/gifs?</code> ‚Üí ein zuf√§lliges GIF.",
                "section.builder": "Query Builder",
                "label.base": "API-Basis-URL",
                "hint.base": "Deine deployte Instanz. Kein Slash am Ende n√∂tig.",
                "label.nsfw": "NSFW-Modus",
                "hint.nsfw": "Standard ist <code>false</code>.",
                "label.list": "Liste (list)",
                "hint.list": "Mit <code>list=tags</code> bekommst du alle verf√ºgbaren Tags.",
                "label.q": "Suche im Titel (q)",
                "hint.q": "Wenn gesetzt, dann kein tag/anime/character benutzen.",
                "label.tag": "Tag (tag)",
                "btn.refreshTags": "Tags neu laden",
                "hint.tags": "Dropdown l√§dt mit <code>GET /gifs?list=tags</code>.",
                "label.anime": "Anime (anime)",
                "hint.anime": "Exakter Match (case-insensitive).",
                "label.character": "Character (character)",
                "hint.character": "Exakter Match (case-insensitive).",
                "label.limit": "Limit (limit)",
                "hint.limit": "Wie viele Ergebnisse maximal zur√ºckgegeben werden.",
                "label.offset": "Offset (offset)",
                "hint.offset": "Startposition (Pagination).",
                "btn.presetRandom": "Preset: Random",
                "btn.presetSfw": "Preset: Random SFW",
                "btn.presetTag": "Preset: Tag",
                "btn.presetAnime": "Preset: Anime",
                "btn.presetChar": "Preset: Character",
                "btn.reset": "Zur√ºcksetzen",
                "label.finalUrl": "Fertige URL",
                "btn.copy": "Kopieren",
                "btn.share": "Share-Link",
                "btn.run": "Ausf√ºhren",
                "tab.py": "Python (requests)",
                "tab.curl": "cURL",
                "btn.copyCode": "Code kopieren",
                "section.response": "Antwort",
                "btn.openGif": "GIF √∂ffnen",
                "btn.copyGifUrl": "GIF-URL kopieren",
                "btn.prev": "¬´ Zur√ºck",
                "btn.next": "Weiter ¬ª",
                "section.history": "History (local)",
                "history.info": "Zuletzt ausgef√ºhrte Anfragen. Klicke, um sie erneut zu laden.",
                "btn.clearHistory": "History l√∂schen",
                "section.docs": "API-Dokumentation",
                "docs.rules.title": "<b>Regeln &amp; Verhalten</b>",
                "docs.rule1": "<span class='kbd'>q</span> (Titelsuche) ist exklusiv: <b>Entweder</b> <span class='kbd'>q</span> <b>oder</b> genau eins von <span class='kbd'>tag</span>/<span class='kbd'>anime</span>/<span class='kbd'>character</span>.",
                "docs.rule2": "<span class='kbd'>nsfw</span> ‚àà {<code>false</code>, <code>true</code>, <code>only</code>} ‚Äì Standard <code>false</code>.",
                "docs.rule3": "Ohne Filter liefert <code>/gifs?</code> ein zuf√§lliges GIF (mit NSFW-Filter laut <code>nsfw</code>).",
                "docs.rule4": "<span class='kbd'>limit</span> &amp; <span class='kbd'>offset</span> dienen der Pagination (nur bei Titelsuche sinnvoll).",
                "docs.rule5": "<code>list=tags</code> gibt alle Tags zur√ºck (ignoriert andere Filter).",
                "tbl.param": "Parameter", "tbl.type": "Typ", "tbl.example": "Beispiel", "tbl.desc": "Beschreibung",
                "docs.row.q": "Suche im <b>Titel</b>. Nicht zusammen mit tag/anime/character.",
                "docs.row.tag": "Random GIF mit diesem Tag.",
                "docs.row.anime": "Random GIF aus diesem Anime.",
                "docs.row.character": "Random GIF mit diesem Character.",
                "docs.row.list": "Liste aller Tags.",
                "docs.row.nsfw": "<code>false</code>=nur SFW, <code>true</code>=beides, <code>only</code>=nur NSFW.",
                "docs.row.limit": "Max. Ergebnisse (1‚Äì200). F√ºr Titelsuche.",
                "docs.row.offset": "Startposition (Pagination). F√ºr Titelsuche.",
                "docs.note": "Hinweis: Bei Tippfehlern in <code>anime</code>/<code>character</code> liefert die API sinnvolle Vorschl√§ge im Fehlerobjekt (HTTP 404, Feld <code>suggestions</code>).",
                "ph.q": "z. B. Nazuna", "ph.anime": "Call of the Night", "ph.character": "Nazuna", "ph.limit": "z. B. 50", "ph.offset": "z. B. 0", "ph.base": "https://deine-api.tld"
            },
            en: {
                "title.main": "Anime GIF API ‚Äì Explorer & Docs",
                "intro.main": "Build requests for <code>/gifs</code>, instantly see the URL, code (Python &amp; cURL) and the response. If everything is empty we call <code>/gifs?</code> ‚Üí a random GIF.",
                "section.builder": "Query Builder",
                "label.base": "API Base URL",
                "hint.base": "Your deployed instance. No trailing slash needed.",
                "label.nsfw": "NSFW mode",
                "hint.nsfw": "Default is <code>false</code>.",
                "label.list": "List (list)",
                "hint.list": "Use <code>list=tags</code> to fetch all available tags.",
                "label.q": "Search in title (q)",
                "hint.q": "If set, do not use tag/anime/character.",
                "label.tag": "Tag (tag)",
                "btn.refreshTags": "Reload tags",
                "hint.tags": "Dropdown is loaded via <code>GET /gifs?list=tags</code>.",
                "label.anime": "Anime (anime)",
                "hint.anime": "Exact match (case-insensitive).",
                "label.character": "Character (character)",
                "hint.character": "Exact match (case-insensitive).",
                "label.limit": "Limit (limit)",
                "hint.limit": "Maximum number of results returned.",
                "label.offset": "Offset (offset)",
                "hint.offset": "Start position for pagination.",
                "btn.presetRandom": "Preset: Random",
                "btn.presetSfw": "Preset: Random SFW",
                "btn.presetTag": "Preset: Tag",
                "btn.presetAnime": "Preset: Anime",
                "btn.presetChar": "Preset: Character",
                "btn.reset": "Reset",
                "label.finalUrl": "Final URL",
                "btn.copy": "Copy",
                "btn.share": "Share link",
                "btn.run": "Run",
                "tab.py": "Python (requests)",
                "tab.curl": "cURL",
                "btn.copyCode": "Copy code",
                "section.response": "Response",
                "btn.openGif": "Open GIF",
                "btn.copyGifUrl": "Copy GIF URL",
                "btn.prev": "¬´ Prev",
                "btn.next": "Next ¬ª",
                "section.history": "History (local)",
                "history.info": "Most recent requests. Click to replay.",
                "btn.clearHistory": "Clear history",
                "section.docs": "API Documentation",
                "docs.rules.title": "<b>Rules &amp; Behaviour</b>",
                "docs.rule1": "<span class='kbd'>q</span> (title search) is exclusive: <b>either</b> <span class='kbd'>q</span> <b>or</b> exactly one of <span class='kbd'>tag</span>/<span class='kbd'>anime</span>/<span class='kbd'>character</span>.",
                "docs.rule2": "<span class='kbd'>nsfw</span> ‚àà {<code>false</code>, <code>true</code>, <code>only</code>} ‚Äì default <code>false</code>.",
                "docs.rule3": "With no filters <code>/gifs?</code> returns a random GIF (respecting <code>nsfw</code>).",
                "docs.rule4": "<span class='kbd'>limit</span> &amp; <span class='kbd'>offset</span> are for pagination (useful with title search).",
                "docs.rule5": "<code>list=tags</code> returns all tags (ignores other filters).",
                "tbl.param": "Parameter", "tbl.type": "Type", "tbl.example": "Example", "tbl.desc": "Description",
                "docs.row.q": "Search in <b>title</b>. Do not combine with tag/anime/character.",
                "docs.row.tag": "Random GIF with this tag.",
                "docs.row.anime": "Random GIF from this anime.",
                "docs.row.character": "Random GIF with this character.",
                "docs.row.list": "List of all tags.",
                "docs.row.nsfw": "<code>false</code>=SFW only, <code>true</code>=both, <code>only</code>=NSFW only.",
                "docs.row.limit": "Max results (1‚Äì200). For title search.",
                "docs.row.offset": "Start position (pagination). For title search.",
                "docs.note": "Note: When you misspell <code>anime</code>/<code>character</code>, the API returns suggestions in the error object (HTTP 404, field <code>suggestions</code>).",
                "ph.q": "e.g. Nazuna", "ph.anime": "Call of the Night", "ph.character": "Nazuna", "ph.limit": "e.g. 50", "ph.offset": "e.g. 0", "ph.base": "https://your-api.tld"
            }
        };

        function getLang() {
            const saved = localStorage.getItem('gifapi_lang');
            if (saved) return saved;
            const nav = (navigator.language || 'en').toLowerCase();
            return nav.startsWith('de') ? 'de' : 'en';
        }

        function applyI18n(lang) {
            const dict = I18N[lang] || I18N.en;

            // Set document title, too
            if (dict["title.main"]) document.title = dict["title.main"];

            document.querySelectorAll('[data-i18n]').forEach(n => {
                const k = n.getAttribute('data-i18n');
                if (dict[k] != null) n.innerHTML = dict[k];
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(n => {
                const k = n.getAttribute('data-i18n-placeholder');
                if (dict[k] != null) n.setAttribute('placeholder', dict[k]);
            });
            document.querySelectorAll('[data-i18n-attr]').forEach(n => {
                n.getAttribute('data-i18n-attr').split('|').forEach(pair => {
                    const [attr, k] = pair.split(':');
                    if (attr && k && dict[k] != null) n.setAttribute(attr.trim(), dict[k]);
                });
            });

            const select = document.getElementById('lang');
            if (select) select.value = lang;
        }

        window.addEventListener('load', () => {
            const lang = getLang();
            applyI18n(lang);
            const picker = document.getElementById('lang');
            if (picker) {
                picker.value = lang;
                picker.addEventListener('change', () => {
                    const l = picker.value;
                    localStorage.setItem('gifapi_lang', l);
                    applyI18n(l);
                });
            }
        });
    </script>
</body>

</html>